#!/bin/sh
. "$(dirname -- "$0")/_/husky.sh"

# 커밋 메시지 파일 경로
COMMIT_MESSAGE_FILE_PATH=$1

# 파일 존재 확인
if [ ! -f "$COMMIT_MESSAGE_FILE_PATH" ]; then
  exit 0
fi

# 현재 브랜치명 가져오기
BRANCH_NAME=$(git symbolic-ref --short HEAD 2>/dev/null || echo "")

# 브랜치명에서 DP-숫자 패턴 추출
if echo "$BRANCH_NAME" | grep -q "DP-[0-9]\+"; then
  # DP-숫자 패턴 추출
  JIRA_TICKET=$(echo "$BRANCH_NAME" | grep -o "DP-[0-9]\+" | head -1)
  
  # 기존 커밋 메시지 읽기
  COMMIT_MESSAGE=$(cat "$COMMIT_MESSAGE_FILE_PATH")
  
  # 커밋 메시지 뒤에 " / DP-숫자" 형식으로 추가
  echo "$COMMIT_MESSAGE / $JIRA_TICKET" > "$COMMIT_MESSAGE_FILE_PATH"
fi